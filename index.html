<body>
<h1>Volunteer Service Hours</h1>
<button onclick="login()">Login with Google</button>
<button onclick="logout()">Logout</button>

<div id="log-container" style="display: none;">
    <h2>Log Service Hours</h2>

    <label>Select Organization:
        <select id="org-select">
            <option value="">-- Add new organization --</option>
        </select>
    </label><br/>

    <div id="new-org-fields">
        <label>Organization Name: <input type="text" id="org-name" required /></label><br/>
        <label>Address: <input type="text" id="org-address" /></label><br/>
        <label>Contact First Name: <input type="text" id="contact-first" /></label><br/>
        <label>Contact Last Name: <input type="text" id="contact-last" /></label><br/>
        <label>Title: <input type="text" id="contact-title" /></label><br/>
        <label>Email: <input type="email" id="contact-email" /></label><br/>
        <label>Phone: <input type="tel" id="contact-phone" /></label><br/>
    </div>

    <form id="log-form">
        <label>Organization Name: <input type="text" id="org-name" readonly /></label><br/>
        <label>Organization Address: <input type="text" id="org-address" readonly /></label><br/>
        <label>Contact First Name: <input type="text" id="contact-first" readonly /></label><br/>
        <label>Contact Last Name: <input type="text" id="contact-last" readonly /></label><br/>
        <label>Contact Title: <input type="text" id="contact-title" readonly /></label><br/>
        <label>Contact Email: <input type="email" id="contact-email" readonly /></label><br/>
        <label>Contact Phone: <input type="tel" id="contact-phone" readonly /></label><br/>
        <button type="submit">Submit</button>
    </form>
</div>

<p id="user-info"></p>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-app.js";
    import { getAuth, GoogleAuthProvider, signInWithPopup, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-auth.js";

    const firebaseConfig = {
        apiKey: "AIzaSyA4vFPt7AllttEVTccPqx2mUkq3djDAX_M",
        authDomain: "hoby-ny-east-service-hours.firebaseapp.com",
        projectId: "hoby-ny-east-service-hours",
        storageBucket: "hoby-ny-east-service-hours.firebasestorage.app",
        messagingSenderId: "570357288484",
        appId: "1:570357288484:web:ffd7fc0cd0a880db46d2b1",
        measurementId: "G-J5BP1KY64B"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    window.login = () => {
        const provider = new GoogleAuthProvider();
        signInWithPopup(auth, provider)
            .then((result) => {
                document.getElementById("user-info").textContent = `Hello, ${result.user.displayName}`;
                console.log("Signed in:", result.user);
            })
            .catch((error) => console.error("Login error:", error));
    };

    window.logout = () => {
        signOut(auth)
            .then(() => {
                document.getElementById("user-info").textContent = "";
                console.log("Logged out");
            })
            .catch((error) => console.error("Logout error:", error));
    };

    onAuthStateChanged(auth, async (user) => {
        if (user) {
            document.getElementById("user-info").textContent = `Welcome, ${user.displayName}`;
            document.getElementById("log-container").style.display = "block";
        } else {
            document.getElementById("user-info").textContent = "";
            document.getElementById("log-container").style.display = "none";
        }

        const orgSelect = document.getElementById("org-select");
        const orgRef = collection(db, "organizations");
        const snapshot = await getDocs(orgRef);

        snapshot.forEach(doc => {
            const option = document.createElement("option");
            option.value = doc.id;
            option.textContent = doc.data().name;
            orgSelect.appendChild(option);
        });

    });

    import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.5.2/firebase-firestore.js";

    const orgSelect = document.getElementById("org-select");

    orgSelect.addEventListener("change", async (e) => {
        const orgId = e.target.value;
        const isNew = orgId === "";
        const fields = [
            "org-name", "org-address",
            "contact-first", "contact-last",
            "contact-title", "contact-email", "contact-phone"
        ];

        document.getElementById("new-org-fields").style.display = "block";

        if (isNew) {
            // Clear & make editable
            fields.forEach(id => {
                const input = document.getElementById(id);
                input.value = "";
                input.readOnly = false;
            });
        } else {
            // Fetch org info and populate fields
            const orgDoc = await getDoc(doc(db, "organizations", orgId));
            if (orgDoc.exists()) {
                const org = orgDoc.data();
                document.getElementById("org-name").value = org.name || "";
                document.getElementById("org-address").value = org.address || "";

                const contact = org.contact || {};
                document.getElementById("contact-first").value = contact.firstName || "";
                document.getElementById("contact-last").value = contact.lastName || "";
                document.getElementById("contact-title").value = contact.title || "";
                document.getElementById("contact-email").value = contact.email || "";
                document.getElementById("contact-phone").value = contact.phone || "";

                // Make fields read-only
                fields.forEach(id => {
                    document.getElementById(id).readOnly = true;
                });
            }
        }
    });



</script>
</body>
